(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{7276:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(7357)}])},7357:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>g});var a=r(4848),n=r(6540),l=r(5556),s=r.n(l);let o=e=>{let{onUpload:t}=e,[r,l]=(0,n.useState)(null),[s,o]=(0,n.useState)(!1),i=e=>{if(e&&e.type.startsWith("image/")){let r=new FileReader;r.onloadend=()=>{console.log("FileReader result (base64):",r.result),l(r.result),t(r.result)},r.readAsDataURL(e)}else alert("Please upload a valid image file.")};return(0,a.jsxs)("div",{className:"p-6 border-2 border-gray-300 rounded-lg max-w-md mx-auto",children:[(0,a.jsxs)("div",{className:"p-6 border-2 border-dashed ".concat(s?"border-blue-500 bg-blue-50":"border-gray-300 bg-gray-50"," rounded-lg text-center transition-all duration-200"),onDragOver:e=>{e.preventDefault(),o(!0)},onDragLeave:()=>{o(!1)},onDrop:e=>{e.preventDefault(),o(!1);let t=e.dataTransfer.files[0];console.log("Dropped file:",t),i(t)},children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files[0];console.log("Selected file:",t),i(t)},className:"hidden",id:"file-upload"}),(0,a.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center space-y-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 text-gray-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Drag and drop an image or"," ",(0,a.jsx)("span",{className:"text-blue-500 hover:text-blue-600",children:"browse"})]})]})]}),r&&(0,a.jsxs)("div",{className:"mt-4 p-4 border-2 border-gray-300 rounded-lg",children:[(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("img",{src:r,alt:"Preview",className:"rounded-lg shadow-lg",style:{width:"400px",height:"auto"}})}),(0,a.jsx)("div",{className:"flex justify-center mt-4",children:(0,a.jsx)("button",{onClick:()=>{l(null),t(null)},className:"px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"Clear Image"})})]})]})};o.propTypes={onUpload:s().func.isRequired};var i={cm:!0,mm:!0,in:!0,px:!0,pt:!0,pc:!0,em:!0,ex:!0,ch:!0,rem:!0,vw:!0,vh:!0,vmin:!0,vmax:!0,"%":!0};function c(e){var t=function(e){if("number"==typeof e)return{value:e,unit:"px"};var t,r=(e.match(/^[0-9.]*/)||"").toString();t=r.includes(".")?parseFloat(r):parseInt(r,10);var a=(e.match(/[^0-9]*$/)||"").toString();return i[a]?{value:t,unit:a}:(console.warn("React Spinners: ".concat(e," is not a valid css value. Defaulting to ").concat(t,"px.")),{value:t,unit:"px"})}(e);return"".concat(t.value).concat(t.unit)}var d=function(){return(d=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},p=function(e,t){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&0>t.indexOf(a)&&(r[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)0>t.indexOf(a[n])&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]]);return r},u=function(e,t,r){var a="react-spinners-".concat(e,"-").concat(r);if("undefined"==typeof window||!window.document)return a;var n=document.createElement("style");document.head.appendChild(n);var l=n.sheet,s="\n    @keyframes ".concat(a," {\n      ").concat(t,"\n    }\n  ");return l&&l.insertRule(s,0),a}("ClipLoader","0% {transform: rotate(0deg) scale(1)} 50% {transform: rotate(180deg) scale(0.8)} 100% {transform: rotate(360deg) scale(1)}","clip");let m=function(e){var t=e.loading,r=e.color,a=void 0===r?"#000000":r,l=e.speedMultiplier,s=e.cssOverride,o=e.size,i=void 0===o?35:o,m=p(e,["loading","color","speedMultiplier","cssOverride","size"]),h=d({background:"transparent !important",width:c(i),height:c(i),borderRadius:"100%",border:"2px solid",borderTopColor:a,borderBottomColor:"transparent",borderLeftColor:a,borderRightColor:a,display:"inline-block",animation:"".concat(u," ").concat(.75/(void 0===l?1:l),"s 0s infinite linear"),animationFillMode:"both"},void 0===s?{}:s);return void 0===t||t?n.createElement("span",d({style:h},m)):null},h=e=>{let{jsonFilename:t}=e,[r,l]=(0,n.useState)([]),[s,o]=(0,n.useState)([]),[i,c]=(0,n.useState)(!1),[d,p]=(0,n.useState)(null);(0,n.useEffect)(()=>{console.log("jsonFilename:",t),t&&u(t)},[t]);let u=async e=>{c(!0),p(null);try{console.log("Fetching OCR results for file:",e);let t=await fetch("/ocr_results/".concat(e));console.log("Response status:",t.status);let r=await t.text();if(console.log("Response text:",r),!t.ok)throw Error("Ошибка при получении данных");let a=JSON.parse(r);if(console.log("Parsed JSON data:",a),0===a.length){alert("Данные не найдены.");return}let n=Object.keys(a[0]);o(n),l(a)}catch(e){console.error("Ошибка при получении результатов OCR:",e),p(e.message||"Не удалось загрузить данные. Пожалуйста, попробуйте снова.")}finally{c(!1)}},h=(e,t,a)=>{let n=[...r];n[e][t]=a,l(n)},g=async()=>{try{if(!(await fetch("/api/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({filename:t,data:r})})).ok)throw Error("Ошибка при сохранении изменений");alert("Изменения успешно сохранены!")}catch(e){console.error("Ошибка при сохранении изменений:",e),alert("Ошибка при сохранении изменений. Пожалуйста, попробуйте снова.")}};return i?(0,a.jsx)("div",{className:"flex justify-center mt-8",children:(0,a.jsx)(m,{color:"#36D7B7",size:35})}):d?(0,a.jsx)("p",{className:"text-center text-red-600",children:d}):0===r.length?(0,a.jsx)("p",{className:"text-center text-gray-600",children:"Данные отсутствуют."}):(0,a.jsx)("div",{className:"mt-6 flex justify-center",children:(0,a.jsxs)("div",{className:"w-full max-w-3xl",children:[(0,a.jsx)("p",{className:"text-center text-xl text-gray-600 mt-8 mb-4",children:"Таблица редактируема. Вы можете изменить текст."}),(0,a.jsxs)("div",{className:"flex justify-center space-x-4 mb-4",children:[(0,a.jsx)("button",{onClick:g,className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600","aria-label":"Сохранить изменения",children:"Сохранить изменения"}),(0,a.jsx)("button",{onClick:()=>{u(t)},className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600","aria-label":"Сбросить изменения",children:"Сбросить изменения"})]}),(0,a.jsxs)("table",{className:"w-full border-collapse border border-gray-300",children:[(0,a.jsx)("thead",{children:(0,a.jsx)("tr",{className:"bg-gray-100",children:s.map((e,t)=>(0,a.jsx)("th",{className:"p-2 border border-gray-300",children:e},t))})}),(0,a.jsx)("tbody",{children:r.map((e,t)=>(0,a.jsx)("tr",{className:"hover:bg-gray-50",children:s.map((r,n)=>(0,a.jsx)("td",{className:"p-2 border border-gray-300",contentEditable:!0,suppressContentEditableWarning:!0,onBlur:e=>h(t,r,e.target.textContent),children:e[r]},n))},t))})]}),(0,a.jsx)("div",{className:"flex justify-center mt-4",children:(0,a.jsx)("button",{onClick:()=>{let e=new Blob([JSON.stringify(r,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download="ocr_results_".concat(t),a.click(),URL.revokeObjectURL(a.href)},className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600","aria-label":"Скачать JSON",children:"Скачать JSON"})})]})})};h.propTypes={jsonFilename:s().string.isRequired},h.defaultProps={jsonFilename:"default.json"};let g=()=>{let[e,t]=(0,n.useState)(null),[r,l]=(0,n.useState)(null),[s,i]=(0,n.useState)(!1);(0,n.useEffect)(()=>{},[e]);let c=async()=>{if(console.log("Image URL:",e),e){i(!0);try{console.log("Sending image to API...");let t=await fetch("/api/process",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({imageUrl:e})}),r=await t.text();if(console.log("Raw API Response:",r),!t.ok)throw console.error("API Error Response:",r),Error(r||"Ошибка при обработке изображения");let a=JSON.parse(r);console.log("API Response Data:",a),l(a.jsonFilename)}catch(e){console.error("Ошибка при обработке изображения:",e),alert(e.message||"Ошибка при обработке изображения. Пожалуйста, попробуйте снова.")}finally{i(!1)}}};return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4 text-center",children:"Обработчик изображений OCR"}),(0,a.jsx)(o,{onUpload:e=>{t(e),l(null)}}),e&&(0,a.jsxs)("div",{className:"flex flex-col items-center mt-4",children:[(0,a.jsx)("button",{onClick:c,disabled:s,className:"px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 disabled:bg-green-300","aria-label":s?"Обработка изображения":"Обработать изображение",children:s?"Обработка...":"Обработать изображение"}),s&&(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(m,{color:"#36D7B7",size:35})})]}),r&&(0,a.jsx)(h,{jsonFilename:r})]})}},2694:(e,t,r)=>{"use strict";var a=r(6925);function n(){}function l(){}l.resetWarningCache=n,e.exports=function(){function e(e,t,r,n,l,s){if(s!==a){var o=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:l,resetWarningCache:n};return r.PropTypes=r,r}},5556:(e,t,r)=>{e.exports=r(2694)()},6925:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},e=>{var t=t=>e(e.s=t);e.O(0,[636,593,792],()=>t(7276)),_N_E=e.O()}]);